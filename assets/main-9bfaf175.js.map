{"version":3,"file":"main-9bfaf175.js","sources":["../../src/main.ts"],"sourcesContent":["/// <reference types=\"@workadventure/iframe-api-typings\" />\n\n/* ============ LOGS ============ */\nconst L = {\n  log: (...a: any[]) => console.log(\"[WA]\", ...a),\n  err: (...a: any[]) => console.error(\"[WA]\", ...a),\n};\n\n/* ============ CONFIG ============ */\nconst MAP_URL = \"/@/ynov-1733302243/ynov_adventure/new-map\";\nconst ZONES: { id: string; label: string }[] = [\n  { id: \"#TPA-IA\", label: \"IA\" },\n  { id: \"#TPAINFO\", label: \"Informatique\" },\n  { id: \"#TPACYBER\", label: \"Cybersécurité\" },\n  { id: \"#TPAARCHI\", label: \"Architecture\" },\n  { id: \"#TPABIM\", label: \"Bâtiment Numérique\" },\n  { id: \"#TPAAUDIO\", label: \"Audiovisuel\" },\n  { id: \"#TPADIGITAL\", label: \"DIGITAL IA\" },\n  { id: \"#TPA3D\", label: \"3D\" },\n  { id: \"#TPAHUB\", label: \"Accueil\" },\n];\n\n/* ============ RÉGLAGE SIMPLE ============ */\nconst PER_PAGE = 3;\n\n/* ============ ACTION BAR HELPERS ============ */\nfunction addActionButton(id: string, label: string, cb: () => void, style = true) {\n  const ab: any = (WA.ui as any)?.actionBar;\n  if (!ab?.addButton) { L.err(\"actionBar indisponible\"); return false; }\n  try { ab.removeButton?.(id); } catch {}\n  try {\n    const base: any = { id, label, callback: cb, clickCallback: cb };\n    if (style) { base.bgColor = \"#2ea7ff\"; base.isGradient = true; }\n    ab.addButton(base);\n    return true;\n  } catch (e) {\n    try { ab.addButton({ id, label, callback: cb, clickCallback: cb }); return true; }\n    catch (e2) { L.err(\"addButton error:\", e2); return false; }\n  }\n}\nfunction removeActionButton(id: string) {\n  try { (WA.ui as any)?.actionBar?.removeButton?.(id); } catch {}\n}\n\n/* ============ ÉTAT ============ */\nconst MAIN_TP_BTN_ID = \"teleport-btn\";\nlet tpOpen = false;\nlet tpPage = 0;\nlet tpIds: string[] = [];\n\n/* ============ INIT ============ */\nWA.onInit().then(() => {\n  // Ajout du bouton principal\n  let tries = 0; const max = 20;\n  const tryAdd = () => {\n    tries++;\n    const ok = addActionButton(MAIN_TP_BTN_ID, \"Téléportation\", openTeleportMenu, true);\n    if (ok) { L.log(\"Bouton Téléportation OK\"); return; }\n    if (tries < max) setTimeout(tryAdd, 200);\n    else L.err(\"Impossible d’ajouter le bouton Téléportation (action bar).\");\n  };\n  tryAdd();\n\n  // Menu “Paramètres” (optionnel)\n  try {\n    WA.ui.registerMenuCommand?.(\"Téléportation\", openTeleportMenu);\n    ZONES.forEach(z =>\n      WA.ui.registerMenuCommand?.(z.label, () => {\n        try { WA.nav.goToRoom(MAP_URL + z.id); } catch (e) { L.err(\"goToRoom error:\", e); }\n      })\n    );\n  } catch (e) {\n    L.log(\"registerMenuCommand non disponible — pas bloquant.\");\n  }\n\n  // Open the form after few seconds\n  setTimeout(() => {\n    openInitForm();\n  }, 5000);\n}).catch(e => L.err(\"onInit error:\", e));\n\n/* ============ TÉLÉPORTATION PAGINÉE ============ */\nfunction openTeleportMenu() {\n  if (tpOpen) return;\n  tpOpen = true;\n  removeActionButton(MAIN_TP_BTN_ID);\n  tpPage = 0;\n  drawTpPage();\n}\n\nfunction closeTeleportMenu() {\n  clearTpButtons();\n  tpOpen = false;\n  addActionButton(MAIN_TP_BTN_ID, \"Téléportation\", openTeleportMenu, true);\n}\n\nfunction drawTpPage() {\n  clearTpButtons();\n\n  const total = Math.max(1, Math.ceil(ZONES.length / PER_PAGE));\n  tpPage = Math.max(0, Math.min(tpPage, total - 1));\n\n  const start = tpPage * PER_PAGE;\n  const slice = ZONES.slice(start, start + PER_PAGE);\n\n  if (tpPage > 0) addTpBtn(\"tp-prev\", \"◀\", () => { tpPage--; drawTpPage(); });\n  slice.forEach((z, i) => addTpBtn(`tp-${start + i}`, z.label, () => {\n    try { WA.nav.goToRoom(MAP_URL + z.id); } catch (e) { L.err(\"goToRoom error:\", e); }\n    closeTeleportMenu();\n  }));\n  if (tpPage < total - 1) addTpBtn(\"tp-next\", \"▶\", () => { tpPage++; drawTpPage(); });\n\n  addTpBtn(\"tp-close\", \"✖\", closeTeleportMenu);\n}\n\nfunction addTpBtn(id: string, label: string, cb: () => void) {\n  if (addActionButton(id, label, cb, false)) tpIds.push(id);\n}\nfunction clearTpButtons() {\n  tpIds.forEach(id => removeActionButton(id));\n  tpIds = [];\n}\n\nfunction openInitForm(){\n  // Check if the form is already done\n  const formDone = WA.player.state.hasVariable(\"ynov_adventure_form_done\");\n  if (formDone) {\n    L.log(\"Form already done\");\n    return;\n  }\n  \n  L.log(\"Form opened\");\n\n  /// Init the variables form variables\n  WA.player.state.saveVariable(\"ynov_adventure_form_done\", false);\n\n  // Disable user control\n  WA.controls.disablePlayerControls();\n\n  // Open the form\n  // @ts-ignore: UI API is not typed\n  WA.ui.modal.openModal({\n    title: \"Formulaire de présentation\",\n    allowApi: true,\n    position: \"center\",\n    allow: null,\n    src: \"https://blocksurvey.io/xT1hdkDrQ7WQWPssxz04kA?v=o\",\n    allowFullScreen: true,\n    // @ts-ignore: UI API is not typed\n    closable: false,\n  }, ()=> {\n    L.log(\"Form closed\");\n    WA.controls.restorePlayerControls();\n  });\n}\n\n/* ✅ Pour le mode isolatedModules */\nexport {};\n"],"names":["L","a","MAP_URL","ZONES","PER_PAGE","addActionButton","id","label","cb","style","_a","_b","ab","base","e2","removeActionButton","_c","MAIN_TP_BTN_ID","tpOpen","tpPage","tpIds","tries","max","tryAdd","openTeleportMenu","z","e","openInitForm","drawTpPage","closeTeleportMenu","clearTpButtons","total","start","slice","addTpBtn","i"],"mappings":"AAGA,MAAMA,EAAI,CACR,IAAK,IAAIC,IAAa,QAAQ,IAAI,OAAQ,GAAGA,CAAC,EAC9C,IAAK,IAAIA,IAAa,QAAQ,MAAM,OAAQ,GAAGA,CAAC,CAClD,EAGMC,EAAU,4CACVC,EAAyC,CAC7C,CAAE,GAAI,UAAW,MAAO,IAAK,EAC7B,CAAE,GAAI,WAAY,MAAO,cAAe,EACxC,CAAE,GAAI,YAAa,MAAO,eAAgB,EAC1C,CAAE,GAAI,YAAa,MAAO,cAAe,EACzC,CAAE,GAAI,UAAW,MAAO,oBAAqB,EAC7C,CAAE,GAAI,YAAa,MAAO,aAAc,EACxC,CAAE,GAAI,cAAe,MAAO,YAAa,EACzC,CAAE,GAAI,SAAU,MAAO,IAAK,EAC5B,CAAE,GAAI,UAAW,MAAO,SAAU,CACpC,EAGMC,EAAW,EAGjB,SAASC,EAAgBC,EAAYC,EAAeC,EAAgBC,EAAQ,GAAM,CAvBlF,IAAAC,EAAAC,EAwBQ,MAAAC,GAAWF,EAAA,GAAG,KAAH,YAAAA,EAAe,UAC5B,GAAA,EAACE,GAAA,MAAAA,EAAI,WAAa,OAAAZ,EAAE,IAAI,wBAAwB,EAAU,GAC1D,GAAA,EAAEW,EAAAC,EAAG,eAAH,MAAAD,EAAA,KAAAC,EAAkBN,EAAE,MAAW,CAAC,CAClC,GAAA,CACF,MAAMO,EAAY,CAAE,GAAAP,EAAI,MAAAC,EAAO,SAAUC,EAAI,cAAeA,GAC5D,OAAIC,IAASI,EAAK,QAAU,UAAWA,EAAK,WAAa,IACzDD,EAAG,UAAUC,CAAI,EACV,QACG,CACN,GAAA,CAAK,OAAAD,EAAA,UAAU,CAAE,GAAAN,EAAI,MAAAC,EAAO,SAAUC,EAAI,cAAeA,EAAI,EAAU,SACpEM,EAAI,CAAI,OAAAd,EAAA,IAAI,mBAAoBc,CAAE,EAAU,EAAO,CAC5D,CACF,CACA,SAASC,EAAmBT,EAAY,CArCxC,IAAAI,EAAAC,EAAAK,EAsCM,GAAA,EAAGA,GAAAL,GAAAD,EAAA,GAAG,KAAH,YAAAA,EAAe,YAAf,YAAAC,EAA0B,eAA1B,MAAAK,EAAA,KAAAL,EAAyCL,EAAE,MAAW,CAAC,CAChE,CAGA,MAAMW,EAAiB,eACvB,IAAIC,EAAS,GACTC,EAAS,EACTC,EAAkB,CAAA,EAGtB,GAAG,OAAA,EAAS,KAAK,IAAM,CAhDvB,IAAAV,EAAAC,EAkDE,IAAIU,EAAQ,EAAG,MAAMC,EAAM,GACrBC,EAAS,IAAM,CAGnB,GAFAF,IACWhB,EAAgBY,EAAgB,gBAAiBO,EAAkB,EAAI,EAC1E,CAAExB,EAAE,IAAI,yBAAyB,EAAG,MAAQ,CAChDqB,EAAQC,EAAK,WAAWC,EAAQ,GAAG,EAClCvB,EAAE,IAAI,4DAA4D,CAAA,EAElEuB,IAGH,GAAA,EACCZ,GAAAD,EAAA,GAAA,IAAG,sBAAH,MAAAC,EAAA,KAAAD,EAAyB,gBAAiBc,GACvCrB,EAAA,WACJ,CAhEN,IAAAO,EAAAC,EAgEM,OAAAA,GAAAD,EAAA,GAAG,IAAG,sBAAN,YAAAC,EAAA,KAAAD,EAA4Be,EAAE,MAAO,IAAM,CACrC,GAAA,CAAE,GAAG,IAAI,SAASvB,EAAUuB,EAAE,EAAE,QAAYC,EAAG,CAAI1B,EAAA,IAAI,kBAAmB0B,CAAC,CAAG,CAAA,GACnF,OAEO,CACV1B,EAAE,IAAI,oDAAoD,CAC5D,CAGA,WAAW,IAAM,CACF2B,KACZ,GAAI,CACT,CAAC,EAAE,MAAMD,GAAK1B,EAAE,IAAI,gBAAiB0B,CAAC,CAAC,EAGvC,SAASF,GAAmB,CACtBN,IACKA,EAAA,GACTH,EAAmBE,CAAc,EACxBE,EAAA,EACES,IACb,CAEA,SAASC,GAAoB,CACZC,IACNZ,EAAA,GACOb,EAAAY,EAAgB,gBAAiBO,EAAkB,EAAI,CACzE,CAEA,SAASI,GAAa,CACLE,IAET,MAAAC,EAAQ,KAAK,IAAI,EAAG,KAAK,KAAK5B,EAAM,OAASC,CAAQ,CAAC,EACnDe,EAAA,KAAK,IAAI,EAAG,KAAK,IAAIA,EAAQY,EAAQ,CAAC,CAAC,EAEhD,MAAMC,EAAQb,EAASf,EACjB6B,EAAQ9B,EAAM,MAAM6B,EAAOA,EAAQ5B,CAAQ,EAE7Ce,EAAS,GAAYe,EAAA,UAAW,IAAK,IAAM,CAAEf,IAAqBS,GAAA,CAAI,EACpEK,EAAA,QAAQ,CAACR,EAAGU,IAAMD,EAAS,MAAMF,EAAQG,CAAC,GAAIV,EAAE,MAAO,IAAM,CAC7D,GAAA,CAAE,GAAG,IAAI,SAASvB,EAAUuB,EAAE,EAAE,QAAYC,EAAG,CAAI1B,EAAA,IAAI,kBAAmB0B,CAAC,CAAG,CAChEG,GACnB,CAAA,CAAC,EACEV,EAASY,EAAQ,GAAYG,EAAA,UAAW,IAAK,IAAM,CAAEf,IAAqBS,GAAA,CAAI,EAEzEM,EAAA,WAAY,IAAKL,CAAiB,CAC7C,CAEA,SAASK,EAAS5B,EAAYC,EAAeC,EAAgB,CACvDH,EAAgBC,EAAIC,EAAOC,EAAI,EAAK,GAAGY,EAAM,KAAKd,CAAE,CAC1D,CACA,SAASwB,GAAiB,CACxBV,EAAM,QAAQd,GAAMS,EAAmBT,CAAE,CAAC,EAC1Cc,EAAQ,CAAA,CACV,CAEA,SAASO,GAAc,CAGrB,GADiB,GAAG,OAAO,MAAM,YAAY,0BAA0B,EACzD,CACZ3B,EAAE,IAAI,mBAAmB,EACzB,MACF,CAEAA,EAAE,IAAI,aAAa,EAGnB,GAAG,OAAO,MAAM,aAAa,2BAA4B,EAAK,EAG9D,GAAG,SAAS,wBAIT,GAAA,GAAG,MAAM,UAAU,CACpB,MAAO,6BACP,SAAU,GACV,SAAU,SACV,MAAO,KACP,IAAK,oDACL,gBAAiB,GAEjB,SAAU,EAAA,EACT,IAAK,CACNA,EAAE,IAAI,aAAa,EACnB,GAAG,SAAS,uBAAsB,CACnC,CACH"}